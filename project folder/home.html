<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home - Fleet Management</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* === YOUR ORIGINAL CSS - NO CHANGES === */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
    }

    #navbar {
      background: #2c3e50;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    /* ... (All your original CSS remains EXACTLY as you wrote it) ... */

    /* === ADD ONLY THESE NEW STYLES === */
    .phone-marker {
      background: transparent;
      border: none;
    }
    .phone-icon {
      color: #3498db;
      font-size: 24px;
      text-shadow: 0 0 3px white;
    }
  </style>
</head>
<body>
  <!-- === YOUR ORIGINAL NAVBAR === -->
  <div id="navbar">
    <div class="logo">FAHAN LOGISTICS</div>
    <div class="menu">
      <a href="home.html" class="active">MAP</a>
      <a href="reports.html">REPORTS</a>
      <a href="graphs.html">GRAPHS</a>
      <a href="trips.html">TRIPS</a>
    </div>
    <div class="user-profile">
      <i class="fas fa-bell" id="bellIcon"></i>
      <i class="fas fa-cog" id="settingsIcon"></i>
      <a href="accounts.html"><i class="fas fa-user-circle"></i></a>
    </div>

    <!-- Notifications Dropdown -->
    <div class="notifications-dropdown">
      <ul>
        <li>No notifications currently</li>
      </ul>
    </div>

    <!-- Settings Dropdown -->
    <div class="settings-dropdown">
      <ul>
        <li>
          <label>
            <input type="checkbox" id="nightModeCheckbox">
            Night Mode
          </label>
        </li>
      </ul>
    </div>
  </div>

  <!-- === SIDEBAR (CHANGED TO PHONES) === -->
  <div id="sidebar">
    <h2>Phones</h2>
    <div id="loading">Loading phones...</div>
    <ul id="phone-list"></ul>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // === MAP INITIALIZATION ===
    const map = L.map('map').setView([-1.286389, 36.817223], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // === PHONE TRACKING SYSTEM ===
    let phoneMarkers = {};

    // Custom Phone Icon
    function createPhoneIcon() {
      return L.divIcon({
        className: 'phone-marker',
        html: '<div class="phone-icon"><i class="fas fa-mobile-alt"></i></div>',
        iconSize: [30, 30]
      });
    }

    // Fetch Phone Locations
    async function fetchPhones() {
      try {
        const response = await fetch('/api/phones');
        const phones = await response.json();

        // Remove loading message
        document.getElementById('loading').style.display = 'none';

        // Update map markers
        phones.forEach(phone => {
          if (!phoneMarkers[phone.deviceId]) {
            phoneMarkers[phone.deviceId] = L.marker([phone.latitude, phone.longitude], {
              icon: createPhoneIcon()
            }).addTo(map).bindPopup(`
              <b>${phone.deviceId}</b><br>
              Battery: ${phone.batteryLevel}%<br>
              Last Update: ${new Date(phone.timestamp).toLocaleTimeString()}
            `);
          } else {
            phoneMarkers[phone.deviceId]
              .setLatLng([phone.latitude, phone.longitude])
              .setPopupContent(`
                <b>${phone.deviceId}</b><br>
                Battery: ${phone.batteryLevel}%<br>
                Last Update: ${new Date(phone.timestamp).toLocaleTimeString()}
              `);
          }
        });

        // Update sidebar list
        const phoneList = document.getElementById('phone-list');
        phoneList.innerHTML = phones.map(phone => `
          <li onclick="map.setView([${phone.latitude}, ${phone.longitude}], 15)">
            <span class="status-dot ${phone.status === 'active' ? 'active' : 'inactive'}"></span>
            ${phone.deviceId}
            <span style="float:right;color:#3498db">${phone.batteryLevel}%</span>
          </li>
        `).join('');

      } catch (error) {
        console.error('Error:', error);
        document.getElementById('loading').innerHTML = 'Failed to load phones';
      }
    }

    // Refresh every 5 seconds
    setInterval(fetchPhones, 5000);
    fetchPhones();
  </script>
</body>
</html>
